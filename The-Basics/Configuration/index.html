<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Configuration - hook-userguide</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> hook-userguide</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
      <ul class="current">
    
        
            <li class="toctree-l1 ">
                <a class="" href="../..">Home</a>
                
            </li>
        

    
        
            <span>Getting started</span>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../Getting-started/How-to-use/">How to use</a>
                    
                </li>
            
        

    
        
            <span>The Basics</span>
            
                <li class="toctree-l2 ">
                    <a class="" href="../Application/">Application</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../Collections/">Collections</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../Schema/">Schema</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../Custom-routes/">Custom routes</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../Templates/">Templates</a>
                    
                </li>
            
                <li class="toctree-l2 current">
                    <a class="current" href="./">Configuration</a>
                    
                        <ul>
                        
                            <li class="toctree-l3"><a href="#storage-providers">Storage providers</a></li>
                            
                        
                            <li class="toctree-l3"><a href="#email-providers">Email providers</a></li>
                            
                        
                            <li class="toctree-l3"><a href="#composer-packages">Composer packages</a></li>
                            
                        
                            <li class="toctree-l3"><a href="#security">Security</a></li>
                            
                        
                            <li class="toctree-l3"><a href="#task-scheduler">Task scheduler</a></li>
                            
                        
                        </ul>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../Logging/">Logging</a>
                    
                </li>
            
        

    
        
            <span>More</span>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../More/Deployment/">Deployment</a>
                    
                </li>
            
        

    
        
            <span>Tutorials</span>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../Tutorials/OAuth-integration/">OAuth integration</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../Tutorials/Score-ranking/">Score ranking</a>
                    
                </li>
            
                <li class="toctree-l2 ">
                    <a class="" href="../../Tutorials/Sending-mails/">Sending mails</a>
                    
                </li>
            
        

    
</ul>

      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">hook-userguide</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>The Basics &raquo;</li>
        
      
    
    <li>Configuration</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/doubleleft/hook-userguide/" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>Any configuration change need your application to be deployed with the following
command:</p>
<pre><code>hook deploy
</code></pre>

<h1 id="storage-providers">Storage providers</h1>
<p><strong>Windows Azure</strong></p>
<p>Windows Azure Blob Storage config:</p>
<pre><code class="yaml">storage:
  provider: windows_azure
  account: account_name
  key: secret_key_here
  container: uploads # optional
</code></pre>

<p>Add to your <code>hook-ext/packages.yaml</code>:</p>
<pre><code class="yaml">microsoft/windowsazure: 0.4.0
pear-pear.php.net/mail_mime: &quot;*&quot;
pear-pear.php.net/http_request2: &quot;*&quot;
pear-pear.php.net/mail_mimedecode: &quot;*&quot;
</code></pre>

<p><strong>Amazon AWS</strong></p>
<p>Amazon Web Services - Simple Storage Service config:</p>
<pre><code class="yaml">storage:
  provider: amazon_aws
  key: YOUR_AWS_KEY
  secret: YOUR_AWS_SECRET
  bucket: uploads
</code></pre>

<p>Add to your <code>hook-ext/packages.yaml</code>:</p>
<pre><code class="yaml">aws/aws-php-sdk: 2.7.*
</code></pre>

<p><strong>Dropbox</strong></p>
<ol>
<li>Create an <a href="https://www.dropbox.com/developers/apps/create">Dropbox API App</a>, with "Files and Datastores".</li>
<li>Generate your OAuth 2 access token.</li>
</ol>
<pre><code class="yaml">storage:
  provider: dropbox
  access_token: YOUR_ACCESS_TOKEN
</code></pre>

<p>Add to your <code>hook-ext/packages.yaml</code>:</p>
<pre><code class="yaml">dropbox/dropbox-sdk: 1.1.*
</code></pre>

<h1 id="email-providers">Email providers</h1>
<p>You can change your email service provider at any time be editing your <code>hook-ext/config.yaml</code>'s <code>mail</code> section.</p>
<p><strong>Supported drivers:</strong></p>
<ul>
<li><code>mail</code> (default)</li>
<li><code>sendmail</code></li>
<li><code>smtp</code></li>
<li><code>sendgrid</code> (<a href="https://github.com/doubleleft/hook/tree/master/src/Mailer/presets/sendgrid.php">preset</a>)</li>
<li><code>gmail</code> (<a href="https://github.com/doubleleft/hook/tree/master/src/Mailer/presets/gmail.php">preset</a>)</li>
<li><code>amazon_ses</code> (<a href="https://github.com/doubleleft/hook/tree/master/src/Mailer/presets/amazon_ses.php">preset</a>)</li>
</ul>
<p><strong>Example with SMTP:</strong></p>
<pre><code class="yaml"># hook-ext/config.yaml

mail:
  driver: 'smtp'
  host: 'smtp.gmail.com'
  port: 465
  encryption: 'ssl'
  username: 'your-email@gmail.com'
  password: 'your-password'
</code></pre>

<p><strong>Example with <code>amazon_ses</code> preset:</strong></p>
<pre><code class="yaml"># hook-ext/config.yaml

mail:
  driver: amazon_ses
  userame: user@domain.com
  password: password123
</code></pre>

<p><strong>Related content:</strong>
- <a href="https://github.com/doubleleft/hook/wiki/Sending-mails">Sending mails</a></p>
<h1 id="composer-packages">Composer packages</h1>
<p>You're able to require any composer package into your project.</p>
<p>Edit <code>hook-ext/packages.yaml</code> and add the package name and version you need.</p>
<p><strong>Example: Captcha</strong></p>
<p>Add the external package into <code>hook-ext/packages.yaml</code>:</p>
<pre><code class="yaml"># hook-ext/packages.yaml
gregwar/captcha: &quot;dev-master&quot;
</code></pre>

<p>Create a custom route to output captcha image::</p>
<pre><code>$ hook generate:route catpcha
</code></pre>

<pre><code class="php">&lt;?php
// hook-ext/routes/get_catpcha.php
use Gregwar\Captcha\CaptchaBuilder;

/**
 * GET /captcha
 */
Router::get('/captcha', function() {
  $builder = new CaptchaBuilder;
  $builder-&gt;build();
  Response::header('Content-type', 'image/jpeg');
  return $builder-&gt;get(80);
});
</code></pre>

<h1 id="security">Security</h1>
<p>By default, hook has minimal security checks to allow very fast development. As
you need to secure your application, some configurations will be necessary.</p>
<p><strong>allowed_origins</strong></p>
<p>A list of domains that are allowed to use JavaScript client as referrer.</p>
<pre><code class="yaml"># hook-ext/security.yaml
allowed_origins:
  - 'mydomain.com'
  - 'another.domain.com'
</code></pre>

<p><strong>roles</strong></p>
<p>A list of available auth roles for the application. There is two built-in roles
are <code>all</code> and <code>owner</code>.</p>
<pre><code class="yaml"># hook-ext/security.yaml
roles:
  - admin
</code></pre>

<p><strong>collections</strong></p>
<p>Which auth role can do <code>read</code>, <code>create</code>, <code>update</code> and <code>delete</code> operations. The
allowed arguments for each operations are <code>all</code>, <code>owner</code> and any roles you've
defined in the previous section.</p>
<pre><code class="yaml"># hook-ext/security.yaml
collections:
  events:
    read: all     # everyone can read
    create: owner # only the owner can create
    update: owner # only the owner can update
    delete: none  # nobody can delete it.
</code></pre>

<p>When a collection operation has the <code>all</code> argument, there is no restriction to
perform it.</p>
<p>When a collection operation has the <code>owner</code> argument, it needs to have an
<code>auth_id</code> attribute equals to the current authenticated user.</p>
<p>By default, every collection have the following configuration:</p>
<pre><code class="yaml">collections:
  default:
    create: 'all'
    read: 'all'
    update: 'owner'
    delete: 'owner'
</code></pre>

<h1 id="task-scheduler">Task scheduler</h1>
<p>Scheduled tasks is a way of scheduling <a href="../Custom-routes">custom routes</a> to be
called at a time interval.</p>
<p>Let's generate a schedule template:</p>
<pre><code class="bash">$ hook generate:schedule
Schedule configuration created at 'hook-ext/schedule.yaml'.
</code></pre>

<p>On schedule configuration, it's possible to specify intervals such as <code>daily</code>,
<code>hourly</code>, <code>monthly</code>, <code>weekly</code>, or a raw crontab expression.</p>
<p>The following example configure the route <code>GET /update_something</code> to run every
day.</p>
<pre><code class="yaml"># hook-ext/schedule.yaml
schedule:
  - task: update_something
    schedule: daily
</code></pre>

<p>After deployng your application, the crontab will install this configuration on
the server.</p>
<p>To view your raw crontab schedule, use <code>hook schedule</code>:</p>
<pre><code>0 0 * * * curl -XGET -H 'X-App-Id: 36' -H 'X-App-Key: e12d3031809230dcb0d62086709d079e' 'http://hook.ddll.co:8280/index.php/update_something' 2&gt;&amp;1 /dev/null
</code></pre>

<p><strong>Advanced crontab expressions</strong></p>
<p><a href="https://code.google.com/p/ncrontab/wiki/CrontabExamples">Source</a></p>
<p>Following are examples of crontab expressions and how they would interpreted as a recurring schedule.</p>
<pre><code>* * * * *
</code></pre>

<p>This pattern causes a task to be launched every minute.</p>
<pre><code>5 * * * *
</code></pre>

<p>This pattern causes a task to be launched once every hour and at the fifth minute of the hour (00:05, 01:05, 02:05 etc.).</p>
<pre><code>* 12 * * Mon
</code></pre>

<p>This pattern causes a task to be launched every minute during the 12th hour of Monday.</p>
<pre><code>* 12 16 * Mon
</code></pre>

<p>This pattern causes a task to be launched every minute during the 12th hour of Monday, 16th, but only if the day is the 16th of the month.</p>
<pre><code>59 11 * * 1,2,3,4,5
</code></pre>

<p>This pattern causes a task to be launched at 11:59AM on Monday, Tuesday, Wednesday, Thursday and Friday. Every sub-pattern can contain two or more comma separated values.</p>
<pre><code>59 11 * * 1-5
</code></pre>

<p>This pattern is equivalent to the previous one. Value ranges are admitted and defined using the minus character.</p>
<pre><code>*/15 9-17 * * *
</code></pre>

<p>This pattern causes a task to be launched every 15 minutes between the 9th and 17th hour of the day (9:00, 9:15, 9:30, 9:45 and so on... note that the last execution will be at 17:45). The slash character can be used to identify periodic values, in the form of a/b. A sub-pattern with the slash character is satisfied when the value on the left divided by the one on the right gives an integer result (a % b == 0).</p>
<pre><code>* 12 10-16/2 * *
</code></pre>

<p>This pattern causes a task to be launched every minute during the 12th hour of the day, but only if the day is the 10th, the 12th, the 14th or the16th of the month.</p>
<pre><code>* 12 1-15,17,20-25 * *
</code></pre>

<p>This pattern causes a task to be launched every minute during the 12th hour of the day, but the day of the month must be between the 1st and the 15th, the 20th and the 25, or at least it must be the 17th.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../Logging/" class="btn btn-neutral float-right" title="Logging"/>Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../Templates/" class="btn btn-neutral" title="Templates"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    <!-- Copyright etc -->
    </p>
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../Templates/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../Logging/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
